<div class="dashboard-wrap">
  <!-- Header -->
  <header class="dashboard-header">
    <div class="header-content">
      <div class="header-left">
        <h1>Panel de Administraci√≥n</h1>
        <p class="welcome">Bienvenido, <strong>{{ authService.currentUser?.nombre }}</strong></p>
      </div>
      <div class="header-right">
        <button class="btn-logout" (click)="cerrarSesion()">
          üö™ Cerrar Sesi√≥n
        </button>
      </div>
    </div>
  </header>

  <!-- Tabs Navigation -->
  <nav class="tabs-nav">
    <button 
      class="tab-button" 
      [class.active]="tabActiva === 'productos'"
      (click)="cambiarTab('productos')">
      üì± Productos
    </button>
    <button 
      class="tab-button" 
      [class.active]="tabActiva === 'accesorios'"
      (click)="cambiarTab('accesorios')">
      üéß Accesorios
    </button>
    <button 
      class="tab-button" 
      [class.active]="tabActiva === 'ofertas'"
      (click)="cambiarTab('ofertas')">
      üî• Ofertas
    </button>
  </nav>

  <!-- Main Content -->
  <main class="dashboard-main">
    <!-- ============ TAB PRODUCTOS ============ -->
    @if (tabActiva === 'productos') {
      <div class="tab-content">
        <div class="section-header">
          <h2>Gesti√≥n de Productos</h2>
          <button class="btn-primary" (click)="abrirFormularioNuevoProducto()">
            ‚ûï Agregar Nuevo Producto
          </button>
        </div>

        <div class="table-container">
          <table class="products-table">
            <thead>
              <tr>
                <th>Imagen</th>
                <th>Nombre</th>
                <th>Referencia</th>
                <th>Precio</th>
                <th>RAM</th>
                <th>Almacenamiento</th>
                <th>Acciones</th>
              </tr>
            </thead>
            <tbody>
              @if (productos.length === 0) {
                <tr>
                  <td colspan="7" class="empty-state">
                    No hay productos disponibles
                  </td>
                </tr>
              }
              @for (producto of productos; track producto.slug) {
                <tr>
                  <td>
                    <img [src]="producto.foto" [alt]="producto.nombre" class="product-thumb">
                  </td>
                  <td class="product-name">{{ producto.nombre }}</td>
                  <td>{{ producto.referencia }}</td>
                  <td class="product-price">{{ producto.precio | currency }}</td>
                  <td>{{ producto.ram }}</td>
                  <td>{{ producto.almacenamiento }}</td>
                  <td class="actions-cell">
                    <button class="btn-edit" (click)="editarProducto(producto)" title="Editar">
                      ‚úèÔ∏è
                    </button>
                    <button class="btn-delete" (click)="eliminarProducto(producto.slug)" title="Eliminar">
                      üóëÔ∏è
                    </button>
                  </td>
                </tr>
              }
            </tbody>
          </table>
        </div>
      </div>
    }

    <!-- ============ TAB ACCESORIOS ============ -->
    @if (tabActiva === 'accesorios') {
      <div class="tab-content">
        <div class="section-header">
          <h2>Gesti√≥n de Accesorios</h2>
          <button class="btn-primary" (click)="abrirFormularioNuevoAccesorio()">
            ‚ûï Agregar Nuevo Accesorio
          </button>
        </div>

        <div class="table-container">
          <table class="products-table">
            <thead>
              <tr>
                <th>Imagen</th>
                <th>Nombre</th>
                <th>Marca</th>
                <th>Precio</th>
                <th>Informaci√≥n</th>
                <th>Acciones</th>
              </tr>
            </thead>
            <tbody>
              @if (accesorios.length === 0) {
                <tr>
                  <td colspan="6" class="empty-state">
                    No hay accesorios disponibles
                  </td>
                </tr>
              }
              @for (accesorio of accesorios; track accesorio.slug) {
                <tr>
                  <td>
                    <img [src]="accesorio.foto" [alt]="accesorio.nombre" class="product-thumb">
                  </td>
                  <td class="product-name">{{ accesorio.nombre }}</td>
                  <td>{{ accesorio.marca }}</td>
                  <td class="product-price">{{ accesorio.precio | currency }}</td>
                  <td class="info-cell">{{ accesorio.informacion_adicional }}</td>
                  <td class="actions-cell">
                    <button class="btn-edit" (click)="editarAccesorio(accesorio)" title="Editar">
                      ‚úèÔ∏è
                    </button>
                    <button class="btn-delete" (click)="eliminarAccesorio(accesorio.slug)" title="Eliminar">
                      üóëÔ∏è
                    </button>
                  </td>
                </tr>
              }
            </tbody>
          </table>
        </div>
      </div>
    }

    <!-- ============ TAB OFERTAS ============ -->
    @if (tabActiva === 'ofertas') {
      <div class="tab-content">
        <div class="section-header">
          <h2>Gesti√≥n de Ofertas</h2>
          <button class="btn-primary" (click)="abrirFormularioNuevaOferta()">
            ‚ûï Agregar Nueva Oferta
          </button>
        </div>

        <div class="table-container">
          <table class="products-table">
            <thead>
              <tr>
                <th>Imagen</th>
                <th>Nombre</th>
                <th>Referencia</th>
                <th>Precio Original</th>
                <th>Descuento</th>
                <th>Precio Final</th>
                <th>Acciones</th>
              </tr>
            </thead>
            <tbody>
              @if (ofertas.length === 0) {
                <tr>
                  <td colspan="7" class="empty-state">
                    No hay ofertas disponibles
                  </td>
                </tr>
              }
              @for (oferta of ofertas; track oferta.slug) {
                <tr>
                  <td>
                    <img [src]="oferta.foto" [alt]="oferta.nombre" class="product-thumb">
                  </td>
                  <td class="product-name">{{ oferta.nombre }}</td>
                  <td>{{ oferta.referencia }}</td>
                  <td class="product-price">{{ oferta.precio | currency }}</td>
                  <td class="discount-cell">{{ oferta.descuento }}%</td>
                  <td class="final-price">
                    {{ oferta.precio * (1 - oferta.descuento / 100) | currency }}
                  </td>
                  <td class="actions-cell">
                    <button class="btn-edit" (click)="editarOferta(oferta)" title="Editar">
                      ‚úèÔ∏è
                    </button>
                    <button class="btn-delete" (click)="eliminarOferta(oferta.slug)" title="Eliminar">
                      üóëÔ∏è
                    </button>
                  </td>
                </tr>
              }
            </tbody>
          </table>
        </div>
      </div>
    }
  </main>

  <!-- ============ MODAL FORMULARIO PRODUCTOS ============ -->
  @if (mostrarFormularioProducto) {
    <div class="modal-overlay" (click)="cerrarFormularioProducto()">
      <div class="modal-content" (click)="$event.stopPropagation()">
        <div class="modal-header">
          <h3>{{ modoEdicionProducto ? 'Editar Producto' : 'Nuevo Producto' }}</h3>
          <button class="btn-close" (click)="cerrarFormularioProducto()">‚úï</button>
        </div>

        <form class="product-form" (ngSubmit)="guardarProducto()">
          <div class="form-grid">
            <div class="form-group">
              <label>Nombre *</label>
              <input type="text" [(ngModel)]="productoForm.nombre" name="nombre" placeholder="Samsung Galaxy S24 Ultra" required>
            </div>

            <div class="form-group">
              <label>Referencia *</label>
              <input type="text" [(ngModel)]="productoForm.referencia" name="referencia" placeholder="SM-S928B" required>
            </div>

            <div class="form-group">
              <label>Precio *</label>
              <input type="number" [(ngModel)]="productoForm.precio" name="precio" placeholder="3649900" required>
            </div>

            <div class="form-group">
              <label>URL de Foto *</label>
              <input type="url" [(ngModel)]="productoForm.foto" name="foto" placeholder="https://..." required>
            </div>

            <div class="form-group">
              <label>Bater√≠a *</label>
              <input type="text" [(ngModel)]="productoForm.bateria" name="bateria" placeholder="5000 mAh" required>
            </div>

            <div class="form-group">
              <label>Sistema Operativo *</label>
              <input type="text" [(ngModel)]="productoForm.sistema" name="sistema" placeholder="Android 14" required>
            </div>

            <div class="form-group">
              <label>Procesador *</label>
              <input type="text" [(ngModel)]="productoForm.procesador" name="procesador" placeholder="Snapdragon 8 Gen 3" required>
            </div>

            <div class="form-group">
              <label>RAM *</label>
              <input type="text" [(ngModel)]="productoForm.ram" name="ram" placeholder="12GB" required>
            </div>

            <div class="form-group">
              <label>Almacenamiento *</label>
              <input type="text" [(ngModel)]="productoForm.almacenamiento" name="almacenamiento" placeholder="256GB" required>
            </div>

            <div class="form-group">
              <label>Pantalla *</label>
              <input type="text" [(ngModel)]="productoForm.pantalla" name="pantalla" placeholder="6.8 pulgadas AMOLED" required>
            </div>

            <div class="form-group form-group-full">
              <label>C√°mara *</label>
              <input type="text" [(ngModel)]="productoForm.camara" name="camara" placeholder="200MP principal, 50MP teleobjetivo..." required>
            </div>
          </div>

          <div class="form-actions">
            <button type="button" class="btn-secondary" (click)="cerrarFormularioProducto()">
              Cancelar
            </button>
            <button type="submit" class="btn-primary">
              {{ modoEdicionProducto ? 'Actualizar' : 'Guardar' }} Producto
            </button>
          </div>
        </form>
      </div>
    </div>
  }

  <!-- ============ MODAL FORMULARIO ACCESORIOS ============ -->
  @if (mostrarFormularioAccesorio) {
    <div class="modal-overlay" (click)="cerrarFormularioAccesorio()">
      <div class="modal-content" (click)="$event.stopPropagation()">
        <div class="modal-header">
          <h3>{{ modoEdicionAccesorio ? 'Editar Accesorio' : 'Nuevo Accesorio' }}</h3>
          <button class="btn-close" (click)="cerrarFormularioAccesorio()">‚úï</button>
        </div>

        <form class="product-form" (ngSubmit)="guardarAccesorio()">
          <div class="form-grid">
            <div class="form-group">
              <label>Nombre *</label>
              <input type="text" [(ngModel)]="accesorioForm.nombre" name="nombre" placeholder="AirPods Pro" required>
            </div>

            <div class="form-group">
              <label>Marca *</label>
              <input type="text" [(ngModel)]="accesorioForm.marca" name="marca" placeholder="Apple" required>
            </div>

            <div class="form-group">
              <label>Precio *</label>
              <input type="number" [(ngModel)]="accesorioForm.precio" name="precio" placeholder="249000" required>
            </div>

            <div class="form-group">
              <label>URL de Foto *</label>
              <input type="url" [(ngModel)]="accesorioForm.foto" name="foto" placeholder="https://..." required>
            </div>

            <div class="form-group form-group-full">
              <label>Informaci√≥n Adicional *</label>
              <textarea 
                [(ngModel)]="accesorioForm.informacion_adicional" 
                name="informacion_adicional"
                rows="4"
                placeholder="Descripci√≥n detallada del accesorio..."
                required></textarea>
            </div>
          </div>

          <div class="form-actions">
            <button type="button" class="btn-secondary" (click)="cerrarFormularioAccesorio()">
              Cancelar
            </button>
            <button type="submit" class="btn-primary">
              {{ modoEdicionAccesorio ? 'Actualizar' : 'Guardar' }} Accesorio
            </button>
          </div>
        </form>
      </div>
    </div>
  }

  <!-- ============ MODAL FORMULARIO OFERTAS ============ -->
  @if (mostrarFormularioOferta) {
    <div class="modal-overlay" (click)="cerrarFormularioOferta()">
      <div class="modal-content" (click)="$event.stopPropagation()">
        <div class="modal-header">
          <h3>{{ modoEdicionOferta ? 'Editar Oferta' : 'Nueva Oferta' }}</h3>
          <button class="btn-close" (click)="cerrarFormularioOferta()">‚úï</button>
        </div>

        <form class="product-form" (ngSubmit)="guardarOferta()">
          <div class="form-grid">
            <div class="form-group">
              <label>Nombre *</label>
              <input type="text" [(ngModel)]="ofertaForm.nombre" name="nombre" placeholder="Samsung Galaxy S24 Ultra - Oferta Especial" required>
            </div>

            <div class="form-group">
              <label>Referencia *</label>
              <input type="text" [(ngModel)]="ofertaForm.referencia" name="referencia" placeholder="SM-S928B" required>
            </div>

            <div class="form-group">
              <label>Precio Original *</label>
              <input type="number" [(ngModel)]="ofertaForm.precio" name="precio" placeholder="3649900" required>
            </div>

            <div class="form-group">
              <label>Descuento (%) *</label>
              <input type="number" [(ngModel)]="ofertaForm.descuento" name="descuento" placeholder="15" min="0" max="100" required>
            </div>

            <div class="form-group form-group-full">
              <label>URL de Foto *</label>
              <input type="url" [(ngModel)]="ofertaForm.foto" name="foto" placeholder="https://..." required>
            </div>

            <div class="form-group">
              <label>Bater√≠a *</label>
              <input type="text" [(ngModel)]="ofertaForm.bateria" name="bateria" placeholder="5000 mAh" required>
            </div>

            <div class="form-group">
              <label>Sistema Operativo *</label>
              <input type="text" [(ngModel)]="ofertaForm.sistema" name="sistema" placeholder="Android 14" required>
            </div>

            <div class="form-group">
              <label>Procesador *</label>
              <input type="text" [(ngModel)]="ofertaForm.procesador" name="procesador" placeholder="Snapdragon 8 Gen 3" required>
            </div>

            <div class="form-group">
              <label>RAM *</label>
              <input type="text" [(ngModel)]="ofertaForm.ram" name="ram" placeholder="12GB" required>
            </div>

            <div class="form-group">
              <label>Almacenamiento *</label>
              <input type="text" [(ngModel)]="ofertaForm.almacenamiento" name="almacenamiento" placeholder="256GB" required>
            </div>

            <div class="form-group">
              <label>Pantalla *</label>
              <input type="text" [(ngModel)]="ofertaForm.pantalla" name="pantalla" placeholder="6.8 pulgadas AMOLED" required>
            </div>

            <div class="form-group form-group-full">
              <label>C√°mara *</label>
              <input type="text" [(ngModel)]="ofertaForm.camara" name="camara" placeholder="200MP principal, 50MP teleobjetivo..." required>
            </div>
          </div>

          <div class="form-actions">
            <button type="button" class="btn-secondary" (click)="cerrarFormularioOferta()">
              Cancelar
            </button>
            <button type="submit" class="btn-primary">
              {{ modoEdicionOferta ? 'Actualizar' : 'Guardar' }} Oferta
            </button>
          </div>
        </form>
      </div>
    </div>
  }
</div>
